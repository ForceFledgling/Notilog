# Notilog

Для разработки приложения **NotiLog** с сервером и агентом, которое обрабатывает логи и отправляет уведомления по различным событиям, я предложу архитектуру, а также набор фреймворков и библиотек на Python 3. Архитектура будет включать как серверную, так и клиентскую часть.

# TODO

*   добавить отслеживание процессов (запущен/остановлен/упал)
*   добавить админку
*   добавить вебсокеты
*   доабвить celery

# Архитектура приложения

**Агент (Клиентская часть)**

*   Агент устанавливается на клиентскую машину и отслеживает логи (например, `/var/log/syslog` или логи конкретного приложения).
*   Агент имеет конфигурационный файл, в котором указаны параметры логирования и правила фильтрации.
*   Логи могут отправляться на сервер по определенным правилам (например, по достижению определенного объема данных, при появлении ошибки, или по расписанию).
*   Агент шлет данные на сервер через HTTP(S) API.

**Сервер (Серверная часть)**

*   Сервер принимает логи от агентов и сохраняет их в базе данных.
*   Сервер имеет систему правил и триггеров, которые анализируют поступающие логи и принимают решение об отправке уведомлений.
*   Уведомления отправляются на почту или в Telegram в зависимости от конфигурации.
*   Сервер предоставляет веб-интерфейс для управления и настройки правил.

# Основные компоненты

**API (Backend)**

*   RESTful API для приема логов от агентов и для управления через веб-интерфейс.
*   Обработка логов, сохранение их в базе данных, а также выполнение правил и отправка уведомлений.

**Web Interface (Frontend)**

*   Веб-интерфейс для администраторов и пользователей, чтобы просматривать логи, настраивать правила уведомлений и управлять пользователями.

**Уведомления**

*   Система отправки уведомлений через email и Telegram на основе заданных триггеров.

# Технологии и библиотеки

#### 1\. **Агент**

*   **Язык программирования**: Python 3
*   **Конфигурации**: `configparser` (для работы с INI-файлами), `yaml` или `json` для конфигурационных файлов.
*   **Отправка данных на сервер**: `requests` для отправки HTTP-запросов на сервер.
*   **Мониторинг файлов**: `watchdog` для отслеживания изменений в лог-файлах.
*   **Логирование**: стандартный модуль `logging`.

#### 2\. **Сервер**

*   **Веб-фреймворк**: `FastAPI` для создания RESTful API и управления серверной логикой.
*   **Работа с базой данных**: `SQLAlchemy` для ORM, `Alembic` для миграций. Для базы данных — `PostgreSQL` или `SQLite`.
*   **Асинхронная обработка**: `Celery` для выполнения фоновых задач, например, обработки логов и отправки уведомлений.
*   **Уведомления**:
    *   Для Email: `smtplib` или `aiosmtplib` для асинхронной отправки писем.
    *   Для Telegram: `python-telegram-bot` или `aiogram` для асинхронной работы с Telegram API.
*   **Аутентификация и авторизация**: `FastAPI` предоставляет возможность использования OAuth2 или JWT для аутентификации.

#### 3\. **Frontend**

*   **Фреймворк**: `React` или `Vue.js` для построения SPA.
*   **Интеграция с backend**: через REST API, предоставляемый FastAPI.
*   **UI компоненты**: `Material-UI` или `Ant Design` для React, или `Vuetify` для Vue.js.

### Пример рабочего процесса

1.  Агент мониторит лог-файл на клиентской машине.
2.  При возникновении определенного события (например, ошибка, новый лог) агент отправляет данные на сервер через REST API.
3.  Сервер сохраняет данные в базе данных и анализирует их на основе установленных правил.
4.  Если правило срабатывает, сервер отправляет уведомление на указанный email или в Telegram.
5.  Администратор может зайти в веб-интерфейс, чтобы просмотреть логи и настроить новые правила или изменить существующие.

### Масштабирование и надежность

*   Серверная часть может быть развернута в контейнерах с использованием Docker и Kubernetes для автоматического масштабирования.
*   Использование брокера сообщений (например, RabbitMQ или Redis) для обработки задач Celery.
*   Логи могут храниться как в реляционной БД (например, PostgreSQL), так и в NoSQL (например, Elasticsearch) для более гибкого поиска и анализа данных.

Эта архитектура и выбор инструментов предоставляют мощную и гибкую основу для создания системы мониторинга логов и уведомлений.

# Запуск как модуль

После установки пакета через `pip install .` можно будет запускать сервер и агент как модули:

*   **Сервер**: `python -m notilog.server.api` или через `notilog-server`
*   **Агент**: `python -m notilog.client.agent` или через `notilog-agent`

# Запуск через Docker Compose

Чтобы запустить приложение через Docker Compose, выполните команду:

```
docker-compose up --build
```

Это развернет контейнеры для сервера, клиента, базы данных и Redis.

# Основные моменты

**Конфигурация**: Настройки для клиента и сервера можно вынести в отдельные конфигурационные файлы (`config.py`) или использовать переменные окружения, которые можно передавать через `docker-compose.yml`.

**Масштабируемость**: Использование Docker Compose позволяет легко масштабировать приложение, добавляя дополнительные сервисы, например, для обработки очередей или горизонтального масштабирования серверной части.

**Удобство разработки**: Проект структурирован таким образом, чтобы его было удобно разрабатывать и поддерживать как в виде модулей, так и в контейнеризированной среде.